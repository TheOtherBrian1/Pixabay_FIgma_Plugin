<style>
  :root{
    --border-color: rgb(202, 202, 202);
    --border: .5px rgb(202, 202, 202) solid;
  }
  body{
    font-family: Arial, Helvetica, sans-serif;
    padding: 10px;
    margin: 0;
  }
  nav{
    position: fixed;
    top: 0;
    width: 100%;
    padding-top: 3px;
    background-color: azure;
    height: 50px;
    z-index: 10;
  }
  .search{
    display: flex;
    align-items: flex-end;
    justify-content: flex-start;
    width: 100%;
  }
  .search-bar{
    border: none;
    padding-top: 3px;
    border-bottom: var(--border);
    border-top: var(--border);
    width: 60%;
    padding-left: 10px;
    font-weight: 500;
  }
  .search-bar:focus{
    outline: none;
    border-bottom-width: 1px;
  }
  .search-button{
    border-radius: 0;
    border: var(--border);
    width: 15%;
  }
  .selection-options{
    border: var(--border);
    font-weight: 300;
    padding-top: 3px;
    width: 25%;
  }
  #image-flex-container{
    display: flex;
    margin-top: 50px;
    justify-content: center;
  }
  .image-flex{
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
  }
  .image{
    padding: 3px;
    max-width: 100%;
  }

</style>

<nav>
  <div class = "search">
    <button
      class = 'search-button'
      type= "button">
      ðŸ”Ž
    </button>
       
    <input
      type = "text"
      placeholder = "search"
      class = "search-bar"
      onkeypress="searchImagesOnEnter()"
    />
    <select class = 'selection-options'>
        <option value ="all">All</option>
        <option value = "photo">Photos</option>
        <option value = 'vector'>Vectors</option>
        <option value = 'illustration'>Illustrations</option>
    </select>
  </div>
</nav>
<main id = 'image-flex-container'>
</main>




















<script>
    const API_KEY = '17877062-a04b9c48cbd1252cbe29aff01';
    let previousSearch = '';
    let previousType = 'photos'
    const searchButton = document.querySelector('.search-button');
    const input = document.querySelector('.search-bar');
    const imageType = document.querySelector('.selection-options');
    const imageFlexContainer = document.getElementById('image-flex-container');
    let numOfCont = 4;
    let totalPages = 1;
    let previousPage = 1;

    function generateFlexContainers(howManyConts = 4){
        while (imageFlexContainer.firstChild) {
            imageFlexContainer.removeChild(imageFlexContainer.firstChild);
        }
        for(let i = 0; i < howManyConts; i++){
          const flexContainer = document.createElement('div');
          flexContainer.className = 'image-flex';
          imageFlexContainer.appendChild(flexContainer);
        }
        numOfCont = howManyConts;
    }
    function generateImages(urls){
      let i = 0;
      const imageFlex = document.getElementsByClassName('image-flex');
      for(const img of urls){
          const newImage = document.createElement('img');
          newImage.className = 'image';
          if(!img.previewURL)
            continue;
          newImage.src = img.previewURL
          imageFlex[i].appendChild(newImage)
          i++;
          i %= numOfCont;
          console.log(imageFlex[i]);
        };
    }
    async function fetchImages (page=1){
        const search = input.value;
        const type = imageType.value;
        const url = `https://pixabay.com/api/?key=${API_KEY}&q=${search}&image_type=${type}&per_page=70&page=${page}`
        if(search === previousSearch && page === previousPage && type === previousType)
          return;
        response = await fetch(url);
        if(!response.ok){
          console.log('error');
        }
        const json = await response.json();
        let i = 0;
        if(search === previousSearch)
          generateImages(json.hits);
        else{
          generateFlexContainers(numOfCont);
          generateImages(json.hits);
        }
        previousSearch = search;
        previousType = type;
        //previousPage = page;
    }
    fetchImages();

    searchButton.addEventListener('click', ()=>fetchImages());
    input.addEventListener('keypress', searchImagesOnEnter);
    function searchImagesOnEnter(e){
      if (e?.code === "Enter"  || e?.key === "Enter" && !e?.repeat){
        
        fetchImages();
      }
    }

    // parent.postMessage({ pluginMessage: { type: 'create-rectangles', count } }, '*')
    // parent.postMessage({ pluginMessage: { type: 'cancel' } }, '*')

</script>

